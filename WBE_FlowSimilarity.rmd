---
title: "Allometry Results"
author: "Zack Brym"
output: html_document
---

```{r data_setup, include=FALSE}
branch_size <- read.csv("BranchSegments.csv", sep = ',', header = T)
treesum <- read.csv("TreeSummary.csv", sep = ",", head=T)
apple <- branch_size[branch_size$species == "apple",]
cherry <- branch_size[branch_size$species == "cherry",]
PiAu <- subset(apple, tree==20 | tree==19 | tree==14)
B9 <- subset(apple, tree==2 | tree==7 | tree==12 | tree ==3)
library('smatr')
```

```{r graph_generation_functions, include=FALSE}
tree_graph <- function(x, y, test, pred_b, pred_m, labx, laby, position, R2){
  plot(log10(x[1:19]), log10(y[1:19]), 
       xlim = c((log10(min(x))-0.2),(log10(max(x))+0.2)), ylim = c((log10(min(y))-0.2),(log10(max(y))+0.2)),
       xlab = labx, ylab = laby, cex.lab = 1.5, cex = 2.5, pch = 19, col = "black")
  points(log10(x[20:24]), log10(y[20:24]), cex = 2.5, pch = 19, col = "red", bg = "red")
  abline(sma(test)$coef[[1]][1,1], sma(test)$coef[[1]][2,1], lwd = 3, lty = 2)
  abline(sma(test)$coef[[1]][1,2], sma(test)$coef[[1]][2,2], lwd = 3, lty = 3)
  abline(sma(test)$coef[[1]][1,3], sma(test)$coef[[1]][2,3], lwd = 3, lty = 3)
  abline(pred_b, pred_m, lwd = 3, lty = 1)
  legend(position, legend=R2, bty='n', cex=3)  
} #tree-level figures
branch_graph <- function(x, y, test, pred_b, pred_m, labx, laby, position, R2){
  group_data_x <- list()
  group_data_x[[1]] <- x[x$species=="cherry",]

  apple <- x[x$species=="apple",]
  group_data_x[[2]] <- subset(apple, tree==20 | tree==19 | tree==14)
  group_data_x[[3]] <- subset(apple, tree==17 | tree==15 | tree==18)
  group_data_x[[4]] <- subset(apple, tree==13)
  group_data_x[[5]] <- subset(apple, tree==10 | tree==1 | tree==4 | tree ==9)
  group_data_x[[6]] <- subset(apple, tree==5 | tree==11 | tree==6 | tree ==8)
  group_data_x[[7]] <- subset(apple, tree==2 | tree==7 | tree==12 | tree ==3)
  
  group_data_y <- list()
  group_data_y[[1]] <- y[y$species=="cherry",]
  
  apple <- y[y$species=="apple",]
  group_data_y[[2]] <- subset(apple, tree==20 | tree==19 | tree==14)
  group_data_y[[3]] <- subset(apple, tree==17 | tree==15 | tree==18)
  group_data_y[[4]] <- subset(apple, tree==13)
  group_data_y[[5]] <- subset(apple, tree==10 | tree==1 | tree==4 | tree ==9)
  group_data_y[[6]] <- subset(apple, tree==5 | tree==11 | tree==6 | tree ==8)
  group_data_y[[7]] <- subset(apple, tree==2 | tree==7 | tree==12 | tree ==3)
  
  plot(log10(group_data_x[[1]][,3]), log10(group_data_y[[1]][,3]), 
       xlim = c((log10(min(x[,3], na.rm=T))-0.2),(log10(max(x[,3], na.rm=T))+0.2)), 
       ylim = c((log10(min(y[,3], na.rm=T))-0.2),(log10(max(y[,3], na.rm=T))+0.2)),
       xlab = labx, ylab = laby, cex.lab = 1.5, cex = 1.5, pch = 21, col = "red", bg = "red")
  points(log10(group_data_x[[2]][,3]), log10(group_data_y[[2]][,3]), cex = 1.5, pch = 21, col = "black", bg = "orange")
  points(log10(group_data_x[[3]][,3]), log10(group_data_y[[3]][,3]), cex = 1.5, pch = 21, col = "black", bg = 'yellow')
  points(log10(group_data_x[[4]][,3]), log10(group_data_y[[4]][,3]), cex = 1.5, pch = 21, col = "black", bg = 'green')
  points(log10(group_data_x[[5]][,3]), log10(group_data_y[[5]][,3]), cex = 1.5, pch = 21, col = "black", bg = 'cyan')
  points(log10(group_data_x[[6]][,3]), log10(group_data_y[[6]][,3]), cex = 1.5, pch = 21, col = "black", bg = 'blue')
  points(log10(group_data_x[[7]][,3]), log10(group_data_y[[7]][,3]), cex = 1.5, pch = 21, col = "black", bg = 'purple')
  abline(sma(test)$coef[[1]][1,1], sma(test)$coef[[1]][2,1], lwd = 3, lty = 2)
  abline(sma(test)$coef[[1]][1,2], sma(test)$coef[[1]][2,2], lwd = 3, lty = 3)
  abline(sma(test)$coef[[1]][1,3], sma(test)$coef[[1]][2,3], lwd = 3, lty = 3)
  abline(pred_b, pred_m, lwd = 3, lty = 1)
  legend(position, legend=R2, bty='n', cex=3)  
} #branch-level log10-trans
branch_graph2 <- function(x, y, test, pred_b, pred_m, labx, laby, position, R2){
  group_data_x <- list()
  group_data_x[[1]] <- x[x$species=="cherry",]
  
  apple <- x[x$species=="apple",]
  group_data_x[[2]] <- subset(apple, tree==20 | tree==19 | tree==14)
  group_data_x[[3]] <- subset(apple, tree==17 | tree==15 | tree==18)
  group_data_x[[4]] <- subset(apple, tree==13)
  group_data_x[[5]] <- subset(apple, tree==10 | tree==1 | tree==4 | tree ==9)
  group_data_x[[6]] <- subset(apple, tree==5 | tree==11 | tree==6 | tree ==8)
  group_data_x[[7]] <- subset(apple, tree==2 | tree==7 | tree==12 | tree ==3)
  
  group_data_y <- list()
  group_data_y[[1]] <- y[y$species=="cherry",]
  
  apple <- y[y$species=="apple",]
  group_data_y[[2]] <- subset(apple, tree==20 | tree==19 | tree==14)
  group_data_y[[3]] <- subset(apple, tree==17 | tree==15 | tree==18)
  group_data_y[[4]] <- subset(apple, tree==13)
  group_data_y[[5]] <- subset(apple, tree==10 | tree==1 | tree==4 | tree ==9)
  group_data_y[[6]] <- subset(apple, tree==5 | tree==11 | tree==6 | tree ==8)
  group_data_y[[7]] <- subset(apple, tree==2 | tree==7 | tree==12 | tree ==3)
  
  plot(group_data_x[[1]][,3], group_data_y[[1]][,3], 
       xlim = c((min(x[,3], na.rm=T)-0.2),(max(x[,3], na.rm=T)+0.2)), 
       ylim = c((min(y[,3], na.rm=T)-0.2),(max(y[,3], na.rm=T)+0.2)),
       xlab = labx, ylab = laby, cex.lab = 1.5, cex = 1.5, pch = 21, col = "red", bg = "red")
  points(group_data_x[[2]][,3], group_data_y[[2]][,3], cex = 1.5, pch = 21, col = "black", bg = "orange")
  points(group_data_x[[3]][,3], group_data_y[[3]][,3], cex = 1.5, pch = 21, col = "black", bg = 'yellow')
  points(group_data_x[[4]][,3], group_data_y[[4]][,3], cex = 1.5, pch = 21, col = "black", bg = 'green')
  points(group_data_x[[5]][,3], group_data_y[[5]][,3], cex = 1.5, pch = 21, col = "black", bg = 'cyan')
  points(group_data_x[[6]][,3], group_data_y[[6]][,3], cex = 1.5, pch = 21, col = "black", bg = 'blue')
  points(group_data_x[[7]][,3], group_data_y[[7]][,3], cex = 1.5, pch = 21, col = "black", bg = 'purple')
  abline(sma(test)$coef[[1]][1,1], sma(test)$coef[[1]][2,1], lwd = 3, lty = 2)
  abline(sma(test)$coef[[1]][1,2], sma(test)$coef[[1]][2,2], lwd = 3, lty = 3)
  abline(sma(test)$coef[[1]][1,3], sma(test)$coef[[1]][2,3], lwd = 3, lty = 3)
  abline(pred_b, pred_m, lwd = 3, lty = 1)
  legend(position, legend=R2, bty='n', cex=3)  
} #branch-level no log-trans
```

##Frequency Distributions

###Length Histograms
Histograms for segment length, path length, and subtree length levels. Sample size is listed next to title. There are 5 cherry and 19 apple individuals represented. The Biggest Apple is the largest rootstock ('PiAu') with 3 individuals represented. The Smallest Apple is the smallest rootstock ('B9') with 4 individuals represented.  

####Segment Length
```{r length_hist, echo=FALSE}
par(mfrow = c(2,3))
hist(branch_size$length_cm, main = paste("All ( n =",length(branch_size$length_cm),")"), breaks = 40, xlab="segment length")
hist(cherry$length_cm, main = paste("Cherry ( n =",length(cherry$length_cm),")"), breaks = 40, xlab = "segment length")
hist(apple$length_cm, main = paste("Apple ( n =",length(apple$length_cm),")"), breaks = 40, xlab = "segment length")
hist(PiAu$length_cm, main = paste("Biggest Apples ( n =",length(PiAu$length_cm),")"),breaks = 20,xlab = "segment length")
hist(B9$length_cm, main = paste("Smallest Apples ( n =",length(B9$length_cm),")"), breaks = 20, xlab = "segment length")
```

####Path Length *(includes terminal twigs when possible)*
```{r pathlength_hist, echo=FALSE}
par(mfrow = c(2,3))
hist(branch_size$path_length, main = paste("All ( n =",length(branch_size$length_cm),")"), breaks = 40, xlab="path length")
hist(cherry$path_length, main = paste("Cherry ( n =",length(cherry$length_cm),")"), breaks = 40, xlab = "path length")
hist(apple$path_length, main = paste("Apple ( n =",length(apple$length_cm),")"), breaks = 40, xlab = "path length")
hist(PiAu$path_length, main = paste("Biggest Apples ( n =",length(PiAu$length_cm),")"), breaks = 20, xlab="path length")
hist(B9$path_length, main = paste("Smallest Apples ( n =",length(B9$length_cm),")"), breaks = 20, xlab = "path length")
```

####Subtree Length *(includes terminal twigs when possible)*
```{r subtreelength_hist, echo=FALSE}
par(mfrow = c(2,3))
hist(branch_size$tot_length, main = paste("All ( n =",length(branch_size$tot_length),")"), breaks=60, xlab="sum of lengths")
hist(cherry$tot_length, main = paste("Cherry ( n =",length(cherry$tot_length),")"), breaks = 60, xlab = "sum of lengths")
hist(apple$tot_length, main = paste("Apple ( n =",length(apple$tot_length),")"), breaks = 60, xlab = "sum of lengths")
hist(PiAu$tot_length, main = paste("Biggest Apples ( n =",length(PiAu$tot_length),")"), breaks = 60, xlab="sum of lengths")
hist(B9$tot_length, main = paste("Smallest Apples ( n =",length(B9$tot_length),")"), breaks = 60, xlab = "sum of lengths")
```

###Diameter Histograms
Histograms for diameter at an individual level. Sample size is listed next to title. There are 5 cherry and 19 apple individuals represented. The Biggest Apple is the largest rootstock ('PiAu') with 3 individuals represented. The Smallest Apple is the smallest rootstock ('B9') with 4 individuals represented.  
```{r diameter_hist, echo=FALSE}
par(mfrow = c(2,3))
hist(branch_size$diameter_mm, main = paste("All ( n =",length(branch_size[,1]),")"), breaks = 40, xlab="diameter")
hist(cherry$diameter_mm, main = paste("Cherry ( n =",length(cherry[,1]),")"), breaks = 40, xlab = "diameter")
hist(apple$diameter_mm, main = paste("Apple ( n =",length(apple[,1]),")"), breaks = 40, xlab = "diameter")
hist(PiAu$diameter_mm, main = paste("Biggest Apples ( n =",length(PiAu[,1]),")"),breaks = 20,xlab = "diameter")
hist(B9$diameter_mm, main = paste("Smallest Apples ( n =",length(B9[,1]),")"), breaks = 20, xlab = "diameter")
```

###Mass Histograms
Histograms for segment mass, total segment mass, and total subtree mass. Sample size is listed next to title. There are 5 cherry and 19 apple individuals represented. The Biggest Apple is the largest rootstock ('PiAu') with 3 individuals represented. The Smallest Apple is the smallest rootstock ('B9') with 4 individuals represented.  

####Segment Mass
```{r mass_hist, echo=FALSE}
par(mfrow = c(2,3))
hist(branch_size$stem_m, main = paste("All ( n =",length(branch_size[,1]),")"), breaks = 40, xlab="segment mass")
hist(cherry$stem_m, main = paste("Cherry ( n =",length(cherry[,1]),")"), breaks = 40, xlab = "segment mass")
hist(apple$stem_m, main = paste("Apple ( n =",length(apple[,1]),")"), breaks = 40, xlab = "segment mass")
hist(PiAu$stem_m, main = paste("Biggest Apples ( n =",length(PiAu[,1]),")"),breaks = 20,xlab = "segment mass")
hist(B9$stem_m, main = paste("Smallest Apples ( n =",length(B9[,1]),")"), breaks = 20, xlab = "segment mass")
```

####Total Segment Mass *(subtree w/o terminal twigs)*
```{r totmass_hist, echo=FALSE}
par(mfrow = c(2,3))
hist(branch_size$tot_stem_m, main = paste("All ( n =",length(branch_size[,1]),")"), breaks = 40, xlab="total branch mass")
hist(cherry$tot_stem_m, main = paste("Cherry ( n =",length(cherry[,1]),")"), breaks = 40, xlab = "total branch mass")
hist(apple$tot_stem_m, main = paste("Apple ( n =",length(apple[,1]),")"), breaks = 40, xlab = "total branch mass")
hist(PiAu$tot_stem_m, main = paste("Biggest Apples ( n =",length(PiAu[,1]),")"),breaks = 20,xlab = "total branch mass")
hist(B9$tot_stem_m, main = paste("Smallest Apples ( n =",length(B9[,1]),")"), breaks = 20, xlab = "total branch mass")
```

####Subtree Mass *(add twig mass to 'Total Segment Mass')*
```{r subtreemass_hist, echo=FALSE}
par(mfrow = c(2,3))
hist((branch_size$tot_stem_m + branch_size$tot_twig_m), 
     main = paste("All ( n =",length(branch_size[,1]),")"), breaks = 40, xlab="total branch mass")
hist((cherry$tot_stem_m + cherry$tot_twig_m), 
     main = paste("Cherry ( n =",length(cherry[,1]),")"), breaks = 40, xlab = "total branch mass")
hist((apple$tot_stem_m + apple$tot_twig_m), 
     main = paste("Apple ( n =",length(apple[,1]),")"), breaks = 40, xlab = "total branch mass")
hist((PiAu$tot_stem_m + PiAu$tot_twig_m), 
     main = paste("Biggest Apples ( n =",length(PiAu[,1]),")"),breaks = 20,xlab = "total branch mass")
hist((B9$tot_stem_m + B9$tot_twig_m), 
     main = paste("Smallest Apples ( n =",length(B9[,1]),")"), breaks = 20, xlab = "total branch mass")
```

#Scaling in Raw Data and Subtrees (See Table 1 for preditions)

Length ~ Radius^2 (peripheral / fruiting branches)

Length ~ Radius^2/3 (basal / scaffold branches)

Surface Area (2 * pi * Radius * Length) ~ Volume^3/4 (pi * radius^2 * Length)

Daughter/Parent Branch Area ratio

Length ~ Mass ~ Diameter

Surface Area ~ No of terminal branches (WBE)

*subtree is the diameter of a given branch segment, and the total length, total surface area, and total volume of all branch segments distal to that branch segment*